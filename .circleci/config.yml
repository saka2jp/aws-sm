version: 2.1

workflows:
  tests:
    jobs:
      - test:
          matrix:
            parameters:
              python-version: ["3.11", "3.10", "3.9", "3.8"]

jobs:
  test:
    parameters:
      python-version:
        type: string
    executor:
      name: python-docker
      version: <<parameters.version>>
    steps:
      - checkout
      - python/install:
          node-version: << parameters.python-version >>
      - python/install-packages:
          pkg-manager: pipenv
      - run:
          name: Run tests
          command: python -m pytest --tb=line --cov-report=html
      - store_test_results:
          path: test-results
      - store_artifacts:
          path: test-results
          destination: tr1
      - run:
          name: Run flake8
          command: python -m flake8
      - run:
          name: Run radon
          command: |
            python -m radon cc -n C .
            python -m radon mi -n B .
