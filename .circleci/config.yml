version: 2
workflows:
  matrix-tests:
    jobs:
      - test:
          matrix:
            parameters:
              version:
                - 3.11
                - 3.10
                - 3.9
                - 3.8

executors:
  python-docker:
    parameters:
      version:
        description: "version tag"
        default: "lts"
        type: string
    docker:
      - image: cimg/python:<<parameters.version>>

jobs:
  test:
    parameters:
      version:
        description: "version tag"
        default: "lts"
        type: string
    executor:
      name: python-docker
      version: <<parameters.version>>
    steps:
      - checkout
      - python/install-packages:
          pkg-manager: pipenv
      - run:
          name: Run tests
          command: python -m pytest --tb=line --cov-report=html
      - store_test_results:
          path: test-results
      - store_artifacts:
          path: test-results
          destination: tr1
      - run:
          name: Run flake8
          command: python -m flake8
      - run:
          name: Run radon
          command: |
            python -m radon cc -n C .
            python -m radon mi -n B .
